const city__input=document.querySelector("#cityname");let city__display=document.querySelector("#city"),message__error=document.querySelector("#error-message");const data__row=document.querySelector("#current-row"),data__ul=document.querySelector("#current-ul"),form=document.querySelector("#form-id");let access_key="b47768f911ece4c18943aa8a7e04d87d",url="https://api.openweathermap.org/data/2.5/";const getLocation=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(getPosition,showerr):message__error.innerHTML="Allow location service"},getPosition=e=>{const t={lat:e.coords.latitude,lon:e.coords.longitude};fetchGeoData_Current(t),fetchGeoData_FiveDays(t)};function showerr(e){switch(e.code){case e.PERMISSION_DENIED:message__error.innerHTML=" Pls. allow location to get <u>weather</u> from your exact location....or search by city name",fetch_City_Current_Weather(),fetchGeoData_FiveDays({city:"London"});break;case e.POSITION_UNAVAILABLE:message__error.innerHTML="Location information is unavailable.";break;case e.TIMEOUT:message__error.innerHTML="The request to get user location timed out.";break;case e.UNKNOWN_err:message__error.innerHTML="An unknown error occurred."}}const fetchGeoData_FiveDays=async e=>{console.log(e);let t=`${url}/forecast?lat=${e.lat}&lon=${e.lon}&units=metric&appid=${access_key}`;e.city&&(t=`${url}/forecast?q=${e.city},uk&units=metric&appid=${access_key}`);const n=await fetch(t),a=await n.json();console.log(a),getFiveDaysWeather(a)},getFiveDaysWeather=e=>{let t,n,a,r,i,o=new Date,s=0;for(;s<5;){switch(s){case 0:console.log(o.toDateString()),t=e.list.filter(e=>new Date(e.dt_txt).toDateString()===o.toDateString()?e:"");break;case 1:console.log(o.toDateString()),n=e.list.filter(e=>new Date(e.dt_txt).toDateString()===o.toDateString()?e:"");break;case 2:console.log(o.toDateString()),a=e.list.filter(e=>new Date(e.dt_txt).toDateString()===o.toDateString()?e:"");break;case 3:console.log(o.toDateString()),r=e.list.filter(e=>new Date(e.dt_txt).toDateString()===o.toDateString()?e:"");break;case 4:console.log(o.toDateString()),i=e.list.filter(e=>new Date(e.dt_txt).toDateString()===o.toDateString()?e:"");break;default:return}o.setDate(o.getDate()+1),s++}console.log(t);let c="";t.map(n=>{let a=n.main.temp.toFixed(0);document.querySelector("#forecast__Day1").innerHTML=` ${new Date(t[0].dt_txt).toDateString()} (${e.city.name})`,c+=`<div className="col-sm">\n                                 <div class="card  text-blue" >\n                                      <small class="card-header">${new Date(n.dt_txt).toLocaleTimeString()}</small>\n                                      <img src="https://openweathermap.org/img/wn/${n.weather[0].icon}@2x.png"  class="img-fluid" alt="icon">\n                                      <div class="card-footer">\n                                          <small class="card-text forecast-temp">${a}</small><sup> o</sup><span class="forecast-unit">c </span>                                                     \n                                      </div>\n                                  </div>\n                             </div>\n                             `,document.querySelector("#forecast__row1").innerHTML=c});let l="";n.map(t=>{let a=t.main.temp.toFixed(0);document.querySelector("#forecast__Day2").innerHTML=`${new Date(n[0].dt_txt).toDateString()}(${e.city.name})`,l+=`<div className="col-sm">\n                                     <div class="card  text-blue" align-center>\n                                         <small class="card-header">${new Date(t.dt_txt).toLocaleTimeString()}</small>\n                                         <img src="https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png"  alt="icon">\n                                         <div class="card-footer">\n                                                 <small class="card-text forecast-temp">${a}</small> <sup>o</sup><span class="forecast-unit">c </span>                                                   \n                                         </div>\n                                     </div>\n                                 </div> `,document.querySelector("#forecast__row2").innerHTML=l});let m="";a.map(t=>{let n=t.main.temp.toFixed(0);document.querySelector("#forecast__Day3").innerHTML=`${new Date(a[0].dt_txt).toDateString()}(${e.city.name})`,m+=`<div className="col-sm">\n                                 <div class="card  text-blue" align-center>\n                                     <small class="card-header">${new Date(t.dt_txt).toLocaleTimeString()}</small>\n                                     <img src="https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png"  alt="icon">\n                                     <div class="card-footer">\n                                             <small class="card-text forecast-temp">${n}</small> <sup>o</sup><span class="forecast-unit">c </span>                                                    \n                                     </div>\n                                 </div>\n                             </div> `,document.querySelector("#forecast__row3").innerHTML=m});let d="";r.map(t=>{let n=t.main.temp.toFixed(0);document.querySelector("#forecast__Day4").innerHTML=`${new Date(r[0].dt_txt).toDateString()}(${e.city.name})`,d+=`<div className="col-sm">\n                               <div class="card  text-blue" align-center>\n                                   <small class="card-header">${new Date(t.dt_txt).toLocaleTimeString()}</small>\n                                   <img src="https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png"  alt="icon">\n                                   <div class="card-footer">\n                                           <small class="card-text forecast-temp">${n} </small> <sup>o</sup><span class="forecast-unit">c </span>                                                    \n                                   </div>\n                               </div>\n                           </div> `,document.querySelector("#forecast__row4").innerHTML=d});let u="";i.map(t=>{let n=t.main.temp.toFixed(0);document.querySelector("#forecast__Day5").innerHTML=`${new Date(i[0].dt_txt).toDateString()}(${e.city.name})`,u+=`<div className="col-sm">\n                             <div class="card  text-blue" align-center>\n                                 <small class="card-header">${new Date(t.dt_txt).toLocaleTimeString()}</small>\n                                 <img src="https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png"  alt="icon">\n                                 <div class="card-footer">\n                                         <small id = "day-5" class="card-text forecast-temp">${n}</small> \n                                         <small> <sup>o</sup></small><span class="forecast-unit">c</span>                                             \n                                 </div>\n                             </div>\n                         </div> `,document.querySelector("#forecast__row5").innerHTML=u})},fetchGeoData_Current=async e=>{const t=await fetch(`${url}/weather?lat=${e.lat}&lon=${e.lon}&units=metric&appid=${access_key}`),n=await t.json(),{temp:a,feels_like:r,humidity:i}=n.main,{sunrise:o,sunset:s}=n.sys,{deg:c,speed:l}=n.wind,{description:m,icon:d}=n.weather[0],{name:u}=n;displayWeather(a,r,i,o,s,m,d,c,l,u)},fetch_City_Current_Weather=async(e="London")=>{const t=await fetch(`${url}weather?q=${e},uk&units=metric&appid=${access_key}`),n=await t.json(),{humidity:a,feels_like:r,temp:i}=n.main,{sunrise:o,sunset:s}=n.sys,{description:c,icon:l}=n.weather[0],{deg:m,speed:d}=n.wind,{name:u}=n;displayWeather(i,r,a,o,s,c,l,m,d,u)};function convert_From_UnixTimestamp(e){var t=new Date(1e3*e),n=t.getHours(),a="0000"+t.getMinutes(),r="0"+t.getSeconds();return`${n}:${a.substr(-2)}:${r.substr(-2)}`}const convert_All_Temp=e=>{let t=convert_Temp(e);console.log(t),document.querySelector("#current-temp").innerHTML=`${t.temp}<a href="#" id ="current-unit" class="text-white title" title="convert temp unit" type="button" onclick="convert_All_Temp({unit:'${t.unit}',temp:${t.temp}})"><sup>o</sup>${t.unit}</a> `;let n=document.querySelector("#feels-like-temp").innerHTML;n=parseInt(n);let a=document.querySelector("#feels-like-unit").innerHTML,r=convert_Temp({unit:a,temp:n});document.querySelector("#feels-like-temp").innerHTML=r.temp,document.querySelector("#feels-like-unit").innerHTML=r.unit},convert_Temp=e=>{console.log(e);e.unit.toUpperCase();if("C"===e.unit){let t=0;return{unit:"F",temp:t=Math.floor(1.8*e.temp+32)}}if("F"===e.unit){let t=0;return{unit:"C",temp:t=Math.floor((e.temp-32)*(5/9))}}},displayWeather=async(e,t,n,a,r,i,o,s,c,l)=>{let m=e.toFixed(0),d=t.toFixed(0);city__display.innerHTML=l,data__row.innerHTML=`<div class="col-lg-4">\n                                <div className="card">\n                                    <h2 class="text-big">Today</h2> \n                                    <small> ${(new Date).toDateString()}</small>\n                                </div>\n                            </div>\n                            <div class="col-lg-8">\n                                <div classNam="card">\n                                    <img src="https://openweathermap.org/img/wn/${o}@2x.png" alt="icon" />\n                                    <div id="current-temp">${m}<a href="#" id ="current-unit" class="text-white title" title="convert temp unit" type="button" onclick="convert_All_Temp({unit:'C',temp:${m}})"><sup>o</sup>C</a> </div> <br/>\n                                   Feels Like ... <small id="feels-like-temp"> ${d}</small><small><sup>o</sup></small><span id ="feels-like-unit"  class="text-white">C</span> <br/>   \n                                    <small>${i}</small>\n                                </div>\n                            </div> \n                            `,data__ul.innerHTML=`  \n                          <li>humidity : ${n} %</li>\n                          <li>wind-direction : ${s} deg</li>\n                          <li>wind-speed : ${c} m/s</li>\n                          \n                          <marquee class="mt-3" behavior="scroll" direction="up" scrollamount="1">                                    \n                            <li>sun-rise : ${convert_From_UnixTimestamp(a)}</li>\n                            <li>sun-set : ${convert_From_UnixTimestamp(r)}</li>\n                          </marquee>\n                          `};document.addEventListener("DOMContentLoaded",getLocation),document.addEventListener("DOMContentLoaded",e=>{city__input.focus()}),form.addEventListener("submit",e=>{e.preventDefault(),console.log(city__input.value),fetch_City_Current_Weather(city__input.value),fetchGeoData_FiveDays({city:city__input.value})});